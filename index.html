<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Hâ‚‚ ì²´í—˜ ìŠ¤íƒ¬í”„ ë ë¦¬</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#060b18">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;600;800&family=Orbitron:wght@500;700;900&family=Space+Mono:wght@400;700&display=swap');

  :root {
    --bg: #060b18;
    --surface: #0c1324;
    --surface2: #111a30;
    --border: #1a2744;
    --border-glow: #1e3a5f;
    --text: #e8edf5;
    --text-dim: #5a6d8a;
    --cyan: #00d4ff;
    --cyan-glow: rgba(0,212,255,0.25);
    --green: #00e5a0;
    --green-glow: rgba(0,229,160,0.25);
    --gold: #ffd700;
    --gold-glow: rgba(255,215,0,0.25);
    --orange: #ff8c00;
    --blue: #4a7dff;
    --danger: #ff4757;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100dvh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none; z-index: 0;
  }

  .screen { display: none; position: relative; z-index: 1; }
  .screen.active { display: block; }

  /* â•â• NAME SCREEN â•â• */
  .name-screen {
    min-height: 100dvh;
    display: none; flex-direction: column; align-items: center; justify-content: center;
    padding: 40px 24px; text-align: center;
  }
  .name-screen.active { display: flex; }

  .name-logo { font-family: 'Orbitron', sans-serif; font-size: 14px; letter-spacing: 4px; color: var(--cyan); margin-bottom: 8px; }
  .name-title { font-size: 26px; font-weight: 800; margin-bottom: 8px; background: linear-gradient(135deg, var(--cyan), var(--green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .name-subtitle { font-size: 13px; color: var(--text-dim); margin-bottom: 40px; line-height: 1.6; }

  .name-input-wrap { width: 100%; max-width: 320px; margin-bottom: 20px; }
  .name-input {
    width: 100%; padding: 16px 20px; background: var(--surface); border: 1.5px solid var(--border);
    border-radius: 12px; color: var(--text); font-family: 'Noto Sans KR', sans-serif;
    font-size: 16px; outline: none; text-align: center; transition: border-color 0.3s;
  }
  .name-input:focus { border-color: var(--cyan); box-shadow: 0 0 20px var(--cyan-glow); }
  .name-input::placeholder { color: var(--text-dim); }

  .name-submit {
    width: 100%; max-width: 320px; padding: 16px;
    background: linear-gradient(135deg, var(--cyan), #0099cc);
    color: var(--bg); border: none; border-radius: 12px;
    font-family: 'Noto Sans KR', sans-serif; font-size: 16px; font-weight: 700; cursor: pointer;
  }
  .name-submit:active { transform: scale(0.97); }

  /* â•â• STAMP SCREEN â•â• */
  .header {
    position: sticky; top: 0; z-index: 100;
    background: rgba(6,11,24,0.88); backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border); padding: 16px 20px;
    display: flex; justify-content: space-between; align-items: center;
  }
  .header-title { font-family: 'Orbitron', sans-serif; font-size: 12px; letter-spacing: 3px; color: var(--cyan); }
  .header-progress { font-family: 'Space Mono', monospace; font-size: 13px; color: var(--text-dim); }
  .header-progress span { color: var(--cyan); font-weight: 700; }

  .container { max-width: 480px; margin: 0 auto; padding: 20px; }

  .exhibition-info { text-align: center; padding: 28px 0 20px; }
  .exhibition-info h1 { font-size: 22px; font-weight: 800; margin-bottom: 6px; background: linear-gradient(135deg, var(--cyan), var(--green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .user-greeting { font-size: 13px; color: var(--text-dim); line-height: 1.6; }
  .user-greeting strong { color: var(--cyan); font-weight: 600; }

  .stamp-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 16px 0; }
  .stamp-card {
    aspect-ratio: 1; background: var(--surface); border: 1.5px solid var(--border);
    border-radius: 14px; display: flex; flex-direction: column; align-items: center;
    justify-content: center; gap: 6px; padding: 12px 8px;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); position: relative; overflow: hidden;
  }
  .stamp-card.collected { border-color: var(--cyan); background: linear-gradient(145deg, rgba(0,212,255,0.06), rgba(0,229,160,0.04)); box-shadow: 0 0 16px var(--cyan-glow); }
  .stamp-card.collected .stamp-icon { transform: scale(1); opacity: 1; }
  .stamp-card.just-collected { animation: stampPop 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
  @keyframes stampPop { 0% { transform: scale(0.8); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

  .stamp-icon { font-size: 30px; transform: scale(0.6); opacity: 0.15; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
  .stamp-label { font-size: 10px; font-weight: 600; color: var(--text-dim); text-align: center; line-height: 1.3; }
  .stamp-card.collected .stamp-label { color: var(--cyan); }

  .stamp-number { position: absolute; top: 5px; left: 7px; font-family: 'Space Mono', monospace; font-size: 9px; color: var(--text-dim); opacity: 0.3; }
  .stamp-check { position: absolute; top: 5px; right: 7px; width: 16px; height: 16px; border-radius: 50%; border: 1.5px solid var(--border); display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
  .stamp-card.collected .stamp-check { background: var(--cyan); border-color: var(--cyan); }
  .stamp-check::after { content: 'âœ“'; font-size: 9px; color: var(--bg); opacity: 0; transition: opacity 0.3s; }
  .stamp-card.collected .stamp-check::after { opacity: 1; }

  .stamp-grade { display: none; position: absolute; bottom: 5px; right: 7px; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 700; padding: 1px 6px; border-radius: 5px; }
  .stamp-card.collected .stamp-grade { display: block; }
  .stamp-grade.grade-S { background: rgba(255,215,0,0.15); color: var(--gold); }
  .stamp-grade.grade-A { background: rgba(0,229,160,0.15); color: var(--green); }
  .stamp-grade.grade-B { background: rgba(0,212,255,0.15); color: var(--cyan); }
  .stamp-grade.grade-C { background: rgba(255,140,0,0.15); color: var(--orange); }

  .scan-btn {
    display: flex; align-items: center; justify-content: center; gap: 10px;
    width: 100%; padding: 16px; margin: 20px 0;
    background: linear-gradient(135deg, var(--cyan), #0099cc);
    color: var(--bg); border: none; border-radius: 14px;
    font-family: 'Noto Sans KR', sans-serif; font-size: 16px; font-weight: 700;
    cursor: pointer; box-shadow: 0 4px 24px var(--cyan-glow);
  }
  .scan-btn:active { transform: scale(0.97); }
  .scan-btn svg { width: 22px; height: 22px; }

  .report-btn {
    display: none; align-items: center; justify-content: center; gap: 8px;
    width: 100%; padding: 14px; margin-bottom: 12px;
    background: linear-gradient(135deg, var(--gold), #cc9900);
    color: var(--bg); border: none; border-radius: 14px;
    font-family: 'Noto Sans KR', sans-serif; font-size: 15px; font-weight: 700;
    cursor: pointer; box-shadow: 0 4px 24px var(--gold-glow);
    animation: pulse 2s ease-in-out infinite;
  }
  .report-btn.show { display: flex; }
  .report-btn:active { transform: scale(0.97); }
  @keyframes pulse { 0%,100% { box-shadow: 0 4px 24px var(--gold-glow); } 50% { box-shadow: 0 4px 40px rgba(255,215,0,0.4); } }

  /* Scanner */
  .scanner-overlay { display: none; position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.95); flex-direction: column; align-items: center; justify-content: center; }
  .scanner-overlay.active { display: flex; }
  .scanner-wrapper { width: min(85vw, 360px); }
  .scanner-title { text-align: center; font-size: 15px; font-weight: 600; margin-bottom: 20px; color: var(--text); }
  #qr-reader { border-radius: 16px; overflow: hidden; }
  #qr-reader video { border-radius: 16px; }
  .scanner-close { margin-top: 24px; padding: 12px 32px; background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-family: 'Noto Sans KR', sans-serif; font-size: 14px; cursor: pointer; }

  .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px); padding: 14px 24px; background: var(--surface2); border: 1px solid var(--cyan); border-radius: 12px; font-size: 14px; font-weight: 600; color: var(--cyan); opacity: 0; transition: all 0.3s cubic-bezier(0.16,1,0.3,1); z-index: 2000; pointer-events: none; white-space: nowrap; }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  .reset-area { text-align: center; padding: 32px 0; border-top: 1px solid var(--border); margin-top: 16px; }
  .reset-btn { padding: 8px 20px; background: transparent; border: 1px solid var(--border); border-radius: 8px; color: var(--text-dim); font-family: 'Noto Sans KR', sans-serif; font-size: 12px; cursor: pointer; }
  .reset-btn:active { border-color: var(--danger); color: var(--danger); }
  .footer { text-align: center; padding: 12px; font-size: 10px; color: var(--text-dim); opacity: 0.3; }

  /* â•â• REPORT SCREEN â•â• */
  .report-container { max-width: 480px; margin: 0 auto; padding: 0 16px 40px; }

  .rpt-header { text-align: center; padding: 32px 20px 24px; border-bottom: 1px solid var(--border); position: relative; overflow: hidden; }
  .rpt-header::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(ellipse at center, rgba(0,212,255,0.06) 0%, transparent 60%); pointer-events: none; }
  .rpt-header-tag { font-family: 'Orbitron', sans-serif; font-size: 10px; letter-spacing: 4px; color: var(--cyan); margin-bottom: 6px; position: relative; }
  .rpt-header h1 { font-family: 'Orbitron', sans-serif; font-size: 18px; font-weight: 900; letter-spacing: 2px; color: var(--text); margin-bottom: 4px; position: relative; }
  .rpt-header h2 { font-size: 15px; font-weight: 600; color: var(--text-dim); position: relative; }

  .rpt-section { margin-top: 24px; }
  .rpt-section-title { font-size: 13px; font-weight: 700; color: var(--cyan); margin-bottom: 14px; padding-left: 2px; display: flex; align-items: center; gap: 6px; }
  .rpt-section-title::after { content: ''; flex: 1; height: 1px; background: linear-gradient(to right, var(--border), transparent); }

  .rpt-researcher { background: var(--surface); border: 1.5px solid var(--border); border-radius: 16px; padding: 20px; display: flex; gap: 16px; align-items: center; }
  .rpt-avatar { width: 72px; height: 72px; border-radius: 12px; background: linear-gradient(135deg, var(--surface2), var(--border)); border: 1.5px solid var(--border-glow); display: flex; align-items: center; justify-content: center; font-size: 36px; flex-shrink: 0; }
  .rpt-info { flex: 1; }
  .rpt-info-row { display: flex; font-size: 12px; margin-bottom: 5px; line-height: 1.4; }
  .rpt-info-label { color: var(--text-dim); min-width: 62px; flex-shrink: 0; }
  .rpt-info-value { color: var(--text); font-weight: 600; }

  .rpt-exp-list { display: flex; flex-direction: column; gap: 10px; }
  .rpt-exp-card { background: var(--surface); border: 1.5px solid var(--border); border-radius: 14px; padding: 16px 18px; display: flex; align-items: center; gap: 14px; }
  .rpt-exp-icon { font-size: 28px; flex-shrink: 0; width: 40px; text-align: center; }
  .rpt-exp-body { flex: 1; min-width: 0; }
  .rpt-exp-name { font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 4px; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
  .rpt-exp-score { font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700; color: var(--cyan); flex-shrink: 0; }
  .rpt-exp-stars { font-size: 12px; letter-spacing: 2px; margin-bottom: 3px; color: var(--gold); }
  .rpt-exp-comment { font-size: 11px; color: var(--text-dim); line-height: 1.4; }
  .rpt-exp-meta { font-family: 'Space Mono', monospace; font-size: 10px; color: var(--text-dim); opacity: 0.6; margin-top: 3px; }

  .rpt-exp-grade { font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 700; padding: 2px 8px; border-radius: 6px; flex-shrink: 0; }
  .rpt-exp-grade.grade-S { background: rgba(255,215,0,0.15); color: var(--gold); }
  .rpt-exp-grade.grade-A { background: rgba(0,229,160,0.15); color: var(--green); }
  .rpt-exp-grade.grade-B { background: rgba(0,212,255,0.15); color: var(--cyan); }
  .rpt-exp-grade.grade-C { background: rgba(255,140,0,0.15); color: var(--orange); }

  .rpt-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 24px; }
  .rpt-stat-card { background: var(--surface); border: 1.5px solid var(--border); border-radius: 12px; padding: 14px 10px; text-align: center; }
  .rpt-stat-value { font-family: 'Orbitron', sans-serif; font-size: 20px; font-weight: 700; color: var(--cyan); margin-bottom: 4px; }
  .rpt-stat-label { font-size: 10px; color: var(--text-dim); }

  .rpt-overall { text-align: center; padding: 28px 20px; background: var(--surface); border: 1.5px solid var(--border); border-radius: 18px; position: relative; overflow: hidden; }
  .rpt-overall::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at center, var(--overall-glow, rgba(0,212,255,0.06)) 0%, transparent 70%); pointer-events: none; }
  .rpt-overall-label { font-size: 12px; color: var(--text-dim); margin-bottom: 6px; position: relative; }
  .rpt-overall-icon { font-size: 40px; margin-bottom: 6px; position: relative; }
  .rpt-overall-grade { font-family: 'Orbitron', sans-serif; font-size: 48px; font-weight: 900; position: relative; margin-bottom: 4px; text-shadow: 0 0 30px currentColor; }
  .rpt-overall-title { font-size: 18px; font-weight: 800; position: relative; margin-bottom: 16px; }
  .rpt-overall-comment { font-size: 13px; color: var(--text-dim); line-height: 1.8; position: relative; max-width: 300px; margin: 0 auto; }
  .rpt-overall-comment strong { color: var(--text); }

  .rpt-actions { display: flex; flex-direction: column; gap: 10px; margin-top: 28px; }
  .rpt-back-btn { width: 100%; padding: 14px; background: var(--surface2); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: 'Noto Sans KR', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; text-align: center; }

  .rpt-footer { text-align: center; margin-top: 24px; padding: 16px; border-top: 1px solid var(--border); }
  .rpt-footer-text { font-size: 11px; color: var(--text-dim); opacity: 0.4; line-height: 1.6; }

  .rpt-fade-in { animation: fadeUp 0.5s ease-out both; }
  .rpt-fade-in:nth-child(2) { animation-delay: 0.08s; }
  .rpt-fade-in:nth-child(3) { animation-delay: 0.14s; }
  .rpt-fade-in:nth-child(4) { animation-delay: 0.2s; }
  .rpt-fade-in:nth-child(5) { animation-delay: 0.26s; }
  .rpt-fade-in:nth-child(6) { animation-delay: 0.32s; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<!-- NAME -->
<div class="name-screen" id="screen-name">
  <div class="name-logo">Hâ‚‚ EXPERIENCE LAB</div>
  <h1 class="name-title">ìˆ˜ì†Œë†€ì´ì²´í—˜ê´€</h1>
  <p class="name-subtitle">ì²´í—˜ì„ ì‹œì‘í•˜ê¸° ì „ì—<br>ì—°êµ¬ì›ë‹˜ì˜ ì´ë¦„ì„ ì•Œë ¤ì£¼ì„¸ìš”!</p>
  <div class="name-input-wrap">
    <input type="text" class="name-input" id="name-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20" autocomplete="off">
  </div>
  <button class="name-submit" onclick="submitName()">ğŸ”¬ ì²´í—˜ ì‹œì‘í•˜ê¸°</button>
</div>

<!-- STAMP -->
<div class="screen" id="screen-stamp">
  <div class="header">
    <div class="header-title">STAMP RALLY</div>
    <div class="header-progress"><span id="collected-count">0</span> / <span id="total-count">0</span></div>
  </div>
  <div class="container">
    <div class="exhibition-info">
      <h1>Hâ‚‚ ìˆ˜ì†Œ ì—ë„ˆì§€ ì²´í—˜</h1>
      <p class="user-greeting"><strong id="greeting-name"></strong> ì—°êµ¬ì›ë‹˜, ê° ì²´í—˜ ë¶€ìŠ¤ë¥¼ ë°©ë¬¸í•˜ê³ <br>QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì—¬ ìŠ¤íƒ¬í”„ë¥¼ ëª¨ì•„ë³´ì„¸ìš”!</p>
    </div>
    <div class="stamp-grid" id="stamp-grid"></div>
    <button class="report-btn" id="report-btn" onclick="showReport()">ğŸ“‹ ì²´í—˜ ë¦¬í¬íŠ¸ í™•ì¸í•˜ê¸°</button>
    <button class="scan-btn" onclick="openScanner()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M4 7V4h3M20 7V4h-3M4 17v3h3M20 17v3h-3"/><rect x="7" y="7" width="10" height="10" rx="1"/></svg>
      QR ìŠ¤íƒ¬í”„ ìŠ¤ìº”
    </button>
    <div class="reset-area"><button class="reset-btn" onclick="resetStamps()">ìŠ¤íƒ¬í”„ ì´ˆê¸°í™”</button></div>
    <div class="footer">Hâ‚‚ Experience Lab Â· Stamp Rally</div>
  </div>
</div>

<!-- REPORT -->
<div class="screen" id="screen-report">
  <div class="report-container" id="report-content"></div>
</div>

<!-- SCANNER -->
<div class="scanner-overlay" id="scanner-overlay">
  <div class="scanner-wrapper">
    <div class="scanner-title">ğŸ“· QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì„¸ìš”</div>
    <div id="qr-reader"></div>
    <button class="scanner-close" onclick="closeScanner()">ë‹«ê¸°</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const BOOTHS = [
  { id: "BOOTH-01", name: "ìˆ˜ì†Œë©”ê°€ìŠ¤í…Œì´ì…˜ ìš´ì˜", icon: "ğŸ’§" },
  { id: "BOOTH-02", name: "ìˆ˜ì „í•´ íš¨ìœ¨ ì‹¤í—˜",     icon: "âš™ï¸" },
  { id: "BOOTH-03", name: "ìˆ˜ì†Œë„ì‹œ ì²´í—˜",         icon: "ğŸ™ï¸" },
  { id: "BOOTH-04", name: "ìˆ˜ì†Œ ìë™ì°¨ ì‹œìŠ¹",      icon: "ğŸš—" },
  { id: "BOOTH-05", name: "ê·¸ë¦°ìˆ˜ì†Œ ìƒì‚°",         icon: "ğŸŒ±" },
  { id: "BOOTH-06", name: "ìˆ˜ì†Œ ì•ˆì „ ì²´í—˜",        icon: "ğŸ›¡ï¸" },
];

const GRADE_CONFIG = {
  S: { label: "Sê¸‰ ì—°êµ¬ì›", icon: "ğŸ†", color: "var(--gold)", glow: "rgba(255,215,0,0.08)",
    comment: n => `${n} ì—°êµ¬ì›ë‹˜ì€ ë›°ì–´ë‚œ ì—°êµ¬ ëŠ¥ë ¥ìœ¼ë¡œ\nìˆ˜ì†Œ ì—ë„ˆì§€ì˜ ë¯¸ë˜ë¥¼ ë°íˆê³  ìˆìŠµë‹ˆë‹¤.\nì•ìœ¼ë¡œë„ ê¹¨ë—í•œ ì—ë„ˆì§€ë¥¼ ìœ„í•´ í•¨ê»˜ ì—°êµ¬í•´ ì£¼ì„¸ìš”!` },
  A: { label: "Aê¸‰ ì—°êµ¬ì›", icon: "ğŸ¥‡", color: "var(--green)", glow: "rgba(0,229,160,0.08)",
    comment: n => `${n} ì—°êµ¬ì›ë‹˜ì€ í›Œë¥­í•œ ì´í•´ë ¥ì„ ë³´ì—¬ì£¼ì…¨ìŠµë‹ˆë‹¤.\nìˆ˜ì†Œ ì—ë„ˆì§€ ì „ë¬¸ê°€ë¡œì˜ ê°€ëŠ¥ì„±ì´ ë³´ì…ë‹ˆë‹¤!\nì¡°ê¸ˆë§Œ ë” ë„ì „í•˜ë©´ Sê¸‰ë„ ë¬¸ì œì—†ì–´ìš”!` },
  B: { label: "Bê¸‰ ì—°êµ¬ì›", icon: "ğŸ¥ˆ", color: "var(--cyan)", glow: "rgba(0,212,255,0.08)",
    comment: n => `${n} ì—°êµ¬ì›ë‹˜, ì¢‹ì€ ì¶œë°œì…ë‹ˆë‹¤!\nìˆ˜ì†Œ ì—ë„ˆì§€ì— ëŒ€í•œ ê´€ì‹¬ì´ ëŠê»´ì§‘ë‹ˆë‹¤.\nê¾¸ì¤€íˆ í•™ìŠµí•˜ë©´ ë” ë†’ì€ ë“±ê¸‰ì— ë„ì „í•  ìˆ˜ ìˆì–´ìš”!` },
  C: { label: "Cê¸‰ ì—°êµ¬ì›", icon: "ğŸ¥‰", color: "var(--orange)", glow: "rgba(255,140,0,0.08)",
    comment: n => `${n} ì—°êµ¬ì›ë‹˜, ì²« ë°œì„ ë‚´ë””ë ìŠµë‹ˆë‹¤!\nìˆ˜ì†Œ ì—ë„ˆì§€ì˜ ì„¸ê³„ëŠ” ë¬´ê¶ë¬´ì§„í•©ë‹ˆë‹¤.\në‹¤ìŒ ë°©ë¬¸ì—ì„œ ë” ë†’ì€ ë“±ê¸‰ì— ë„ì „í•´ ë³´ì„¸ìš”!` }
};

const BOOTH_COMMENTS = {
  S: "ì™„ë²½í•œ ìˆ˜í–‰! ìµœê³ ì˜ ì„±ê³¼ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!",
  A: "í›Œë¥­í•œ ê²°ê³¼! ë†’ì€ ì´í•´ë„ë¥¼ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.",
  B: "ì¢‹ì€ ì„±ê³¼! ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•˜ë©´ Aë“±ê¸‰!",
  C: "ë„ì „ ì™„ë£Œ! ë‹¤ìŒì—” ë” ë†’ì€ ì ìˆ˜ë¥¼!",
};

const STORAGE_KEY = "stamp_rally_data";
let html5QrCode = null;

function loadData() { try { const r = localStorage.getItem(STORAGE_KEY); if (r) return JSON.parse(r); } catch(e) {} return { userName: "", collected: {} }; }
function saveData(d) { localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }

function showScreen(id) {
  document.querySelectorAll('.screen, .name-screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function submitName() {
  const n = document.getElementById('name-input').value.trim();
  if (!n) { showToast("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"); return; }
  const d = loadData(); d.userName = n; saveData(d);
  showScreen('screen-stamp'); render();
}

function init() {
  const d = loadData();
  if (d.userName) { showScreen('screen-stamp'); render(); } else { showScreen('screen-name'); }
}

function render() {
  const data = loadData();
  const grid = document.getElementById("stamp-grid");
  const cnt = Object.keys(data.collected).length;
  document.getElementById("collected-count").textContent = cnt;
  document.getElementById("total-count").textContent = BOOTHS.length;
  document.getElementById("greeting-name").textContent = data.userName;

  grid.innerHTML = BOOTHS.map((b, i) => {
    const sd = data.collected[b.id];
    const g = sd ? sd.grade || '' : '';
    return `<div class="stamp-card ${sd ? 'collected' : ''}" data-id="${b.id}">
      <span class="stamp-number">${String(i+1).padStart(2,'0')}</span><span class="stamp-check"></span>
      <span class="stamp-icon">${b.icon}</span><span class="stamp-label">${b.name}</span>
      <span class="stamp-grade ${g?'grade-'+g:''}">${g}</span>
    </div>`;
  }).join("");

  document.getElementById("report-btn").classList.toggle("show", cnt >= BOOTHS.length);
}

function collectStamp(boothId, extra = {}) {
  const b = BOOTHS.find(x => x.id === boothId);
  if (!b) { showToast("âŒ ìœ íš¨í•˜ì§€ ì•Šì€ QR ì½”ë“œì…ë‹ˆë‹¤"); return; }
  const d = loadData();
  if (d.collected[boothId]) { showToast(`âœ… "${b.name}" ì´ë¯¸ ìˆ˜ì§‘ ì™„ë£Œ!`); return; }
  d.collected[boothId] = { timestamp: new Date().toISOString(), name: b.name, score: extra.score||null, grade: extra.grade||null, playTime: extra.playTime||null };
  saveData(d); render();
  setTimeout(() => { const c = document.querySelector(`.stamp-card[data-id="${boothId}"]`); if(c) c.classList.add("just-collected"); }, 50);
  const cnt = Object.keys(d.collected).length;
  showToast(cnt >= BOOTHS.length ? "ğŸ‰ ëª¨ë“  ìŠ¤íƒ¬í”„ ìˆ˜ì§‘ ì™„ë£Œ!" : `âœ¨ "${b.name}" ìŠ¤íƒ¬í”„ íšë“! (${cnt}/${BOOTHS.length})`);
}

function openScanner() {
  document.getElementById("scanner-overlay").classList.add("active");
  html5QrCode = new Html5Qrcode("qr-reader");
  html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: { width: 250, height: 250 } }, onScanSuccess, () => {}).catch(() => { showToast("âŒ ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨"); closeScanner(); });
}
function closeScanner() {
  document.getElementById("scanner-overlay").classList.remove("active");
  if (html5QrCode) { html5QrCode.stop().catch(()=>{}); html5QrCode.clear(); html5QrCode = null; }
}
function onScanSuccess(txt) {
  let id = null, ex = {};
  try { const p = JSON.parse(txt); id = p.boothId||p.booth_id||p.id; ex = { score:p.score||null, grade:p.grade||null, playTime:p.playTime||null }; } catch(e) { if(txt.startsWith("BOOTH-")) id = txt.trim(); }
  if (id) { if(navigator.vibrate) navigator.vibrate(100); collectStamp(id, ex); closeScanner(); } else { showToast("âŒ ìœ íš¨í•˜ì§€ ì•Šì€ QR ì½”ë“œì…ë‹ˆë‹¤"); }
}

// â”€â”€ REPORT â”€â”€
function showReport() {
  const data = loadData();
  const col = data.collected, name = data.userName;
  const scores = BOOTHS.map(b => col[b.id]?.score || 0);
  const avg = Math.round(scores.reduce((a,b)=>a+b,0) / scores.length);
  const totalTime = BOOTHS.reduce((s,b) => s + (col[b.id]?.playTime||0), 0);
  const best = BOOTHS.reduce((best,b) => (col[b.id]?.score||0) > (col[best.id]?.score||0) ? b : best, BOOTHS[0]);
  const tg = avg >= 90 ? 'S' : avg >= 80 ? 'A' : avg >= 70 ? 'B' : 'C';
  const gc = GRADE_CONFIG[tg];
  const now = new Date();
  const ds = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')}`;

  const stars = s => s>=90?'â˜…â˜…â˜…â˜…â˜…':s>=80?'â˜…â˜…â˜…â˜…â˜†':s>=70?'â˜…â˜…â˜…â˜†â˜†':s>=60?'â˜…â˜…â˜†â˜†â˜†':'â˜…â˜†â˜†â˜†â˜†';
  const ftime = s => { if(!s) return '-'; const m=Math.floor(s/60),r=s%60; return m>0?`${m}ë¶„ ${r}ì´ˆ`:`${r}ì´ˆ`; };

  document.getElementById('report-content').innerHTML = `
    <div class="rpt-header rpt-fade-in">
      <div class="rpt-header-tag">Hâ‚‚ EXPERIENCE LAB</div>
      <h1>EXPERIENCE REPORT</h1>
      <h2>ìˆ˜ì†Œë†€ì´ì²´í—˜ê´€ ì²´í—˜ ë¦¬í¬íŠ¸</h2>
    </div>
    <div style="padding:0 4px">
      <div class="rpt-section rpt-fade-in">
        <div class="rpt-section-title">ğŸ§‘â€ğŸ”¬ ì—°êµ¬ì› ì •ë³´</div>
        <div class="rpt-researcher">
          <div class="rpt-avatar">ğŸ‘¤</div>
          <div class="rpt-info">
            <div class="rpt-info-row"><span class="rpt-info-label">ì´ ë¦„ :</span><span class="rpt-info-value">${name}</span></div>
            <div class="rpt-info-row"><span class="rpt-info-label">ì§ ì—… :</span><span class="rpt-info-value">ìˆ˜ì†Œì—ë„ˆì§€ ì—°êµ¬ì›</span></div>
            <div class="rpt-info-row"><span class="rpt-info-label">ë°œê¸‰ì¼ :</span><span class="rpt-info-value">${ds}</span></div>
            <div class="rpt-info-row"><span class="rpt-info-label">ID :</span><span class="rpt-info-value" style="font-family:'Space Mono',monospace;font-size:11px">H2-${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}-${String(Math.floor(Math.random()*9999)).padStart(4,'0')}</span></div>
          </div>
        </div>
      </div>

      <div class="rpt-section rpt-fade-in">
        <div class="rpt-section-title">ğŸ“Š ì²´í—˜ ê¸°ë¡</div>
        <div class="rpt-exp-list">
          ${BOOTHS.map(b => { const d=col[b.id]||{}, g=d.grade||'-', sc=d.score||0; return `
            <div class="rpt-exp-card">
              <div class="rpt-exp-icon">${b.icon}</div>
              <div class="rpt-exp-body">
                <div class="rpt-exp-name">${b.name}<span class="rpt-exp-score">${sc}ì </span></div>
                <div class="rpt-exp-stars">${stars(sc)}</div>
                <div class="rpt-exp-comment">${BOOTH_COMMENTS[g]||''}</div>
                <div class="rpt-exp-meta">â± ${ftime(d.playTime)}</div>
              </div>
              <span class="rpt-exp-grade grade-${g}">${g}</span>
            </div>`; }).join("")}
        </div>
      </div>

      <div class="rpt-section rpt-fade-in">
        <div class="rpt-section-title">ğŸ“ˆ ì²´í—˜ í†µê³„</div>
        <div class="rpt-stats">
          <div class="rpt-stat-card"><div class="rpt-stat-value">${avg}</div><div class="rpt-stat-label">í‰ê·  ì ìˆ˜</div></div>
          <div class="rpt-stat-card"><div class="rpt-stat-value" style="font-size:14px">${ftime(totalTime)}</div><div class="rpt-stat-label">ì´ ì†Œìš”ì‹œê°„</div></div>
          <div class="rpt-stat-card"><div class="rpt-stat-value">${best.icon}</div><div class="rpt-stat-label">ìµœê³  ì„±ì  ë¶€ìŠ¤</div></div>
        </div>
      </div>

      <div class="rpt-section rpt-fade-in">
        <div class="rpt-section-title">ğŸ… ì¢…í•© í‰ê°€</div>
        <div class="rpt-overall" style="--overall-glow:${gc.glow}">
          <div class="rpt-overall-label">ìˆ˜ì†Œë„ì‹œ ê³µë¡œ ë“±ê¸‰</div>
          <div class="rpt-overall-icon">${gc.icon}</div>
          <div class="rpt-overall-grade" style="color:${gc.color}">${tg}</div>
          <div class="rpt-overall-title" style="color:${gc.color}">${gc.label}</div>
          <div class="rpt-overall-comment">${gc.comment(name).replace(/\n/g,'<br>')}</div>
        </div>
      </div>

      <div class="rpt-actions rpt-fade-in">
        <button class="rpt-back-btn" onclick="backToStamp()">â† ìŠ¤íƒ¬í”„ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>
      <div class="rpt-footer"><div class="rpt-footer-text">ìˆ˜ì†Œë†€ì´ì²´í—˜ê´€ Â· Hâ‚‚ Experience Playground<br>ë³¸ ë¦¬í¬íŠ¸ëŠ” ì²´í—˜ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</div></div>
    </div>`;
  showScreen('screen-report'); window.scrollTo(0,0);
}

function backToStamp() { showScreen('screen-stamp'); render(); }
function showToast(m) { const t=document.getElementById("toast"); t.textContent=m; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),2500); }
function resetStamps() { if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { localStorage.removeItem(STORAGE_KEY); showScreen('screen-name'); showToast("ğŸ”„ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤"); } }

document.getElementById('name-input').addEventListener('keydown', e => { if(e.key==='Enter') submitName(); });
init();
</script>
</body>
</html>
